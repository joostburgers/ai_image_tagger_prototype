{% extends "base.html" %}

{% block title %}Tag Images - AI Image Bias Tagger{% endblock %}

{% block content %}
<div class="container">
    <div class="tagging-interface">
        <h1>Tag AI-Generated Images</h1>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading image...</p>
        </div>

        <div id="no-images" class="no-images" style="display: none;">
            <h2>No More Images Available</h2>
            <p>You've viewed all available images. Thank you for your contributions!</p>
            <a href="/dashboard" class="btn btn-primary">View Dashboard</a>
        </div>

        <div id="image-container" style="display: none;">
            <div class="tagger-layout">
                <div class="tagger-left">
                    <div class="image-display">
                        <img id="current-image" src="" alt="AI Generated Image">
                    </div>
                    
                    <div class="tagging-form">
                        <div class="form-header">
                            <h3>Select Bias Types (if any):</h3>
                            <button type="button" class="help-icon" id="help-btn" title="Help">?</button>
                        </div>
                        <div class="bias-checkboxes">
                            <label class="bias-checkbox">
                                <input type="checkbox" name="bias" value="age">
                                <span class="checkbox-label">Age Discrimination</span>
                            </label>
                            <label class="bias-checkbox">
                                <input type="checkbox" name="bias" value="race">
                                <span class="checkbox-label">Race & Ethnicity</span>
                            </label>
                            <label class="bias-checkbox">
                                <input type="checkbox" name="bias" value="gender">
                                <span class="checkbox-label">Gender</span>
                            </label>
                            <label class="bias-checkbox">
                                <input type="checkbox" name="bias" value="class">
                                <span class="checkbox-label">Class & Socioeconomic Status</span>
                            </label>
                        </div>

                        <div class="action-buttons">
                            <button id="submit-btn" class="btn btn-primary">Submit Tags</button>
                            <button id="no-bias-btn" class="btn btn-secondary">No Bias - Next Image</button>
                        </div>
                    </div>
                </div>

                <div class="tagger-right">
                    <div class="image-info">
                        <p><strong>Source:</strong> <span id="image-source"></span></p>
                        <p><strong>Generator:</strong> <span id="image-generator"></span></p>
                        <p><strong>Prompt:</strong> <span id="image-prompt"></span></p>
                        <p><strong>Tags:</strong> <span id="image-tags"></span></p>
                        <div class="engagement-metrics">
                            <span class="metric-item">
                                <span class="heart-icon">❤️</span>
                                <span id="like-count"></span>
                            </span>
                            <span class="metric-item">
                                <i class="bi bi-share share-icon"></i>
                                <span id="share-count"></span>
                            </span>
                        </div>
                    </div>

                    <div class="notes-section">
                        <label for="notes">Additional Notes (optional):</label>
                        <textarea id="notes" rows="8" placeholder="Describe the bias you observed..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="progress-indicator">
            <p id="progress-text">Images tagged this session: <strong>0</strong></p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<div id="help-popup" class="help-popup" style="display: none;">
    <div class="help-popup-content">
        <button class="help-close" id="help-close">&times;</button>
        <h3>Instructions</h3>
        <p>Review the image and select any bias types you observe. If you don't see any bias, click "No Bias - Next Image".</p>
        <p>Each image is shown to 5 different users. Images without any bias tags after 5 views are removed from the system.</p>
    </div>
</div>
<script src="{{ url_for('static', filename='js/tagger.js') }}"></script>
<script>
    // Help popup functionality
    document.getElementById('help-btn').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('help-popup').style.display = 'flex';
    });
    
    document.getElementById('help-close').addEventListener('click', function() {
        document.getElementById('help-popup').style.display = 'none';
    });
    
    document.getElementById('help-popup').addEventListener('click', function(e) {
        if (e.target === this) {
            this.style.display = 'none';
        }
    });
</script>
{% endblock %}
